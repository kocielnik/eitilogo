\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{testeitilogo}[2022/08/09 Test EITI Logo]

\RequirePackage{pgf}
\RequirePackage{etex} % locdimen
% \RequirePackage{xparse} % NewDocumentCommand
\RequirePackage{assert}
\RequirePackage{eitilogo}

\DeclareOption{pagewith}{
    \newcommand\pagewith[1]{%
        % Usage: \pagewith{PageSizeWillMatchThisText}
        % By David Carlisle,
        %     https://tex.stackexchange.com/a/299008
    
        % Save initial lengths.
        \newgeometry{margin=0pt, offset=-1in}

        \locdimen\prevpageheight
        \locdimen\prevpagewidth
    
        \setlength\prevpageheight\pageheight
        \setlength\prevpagewidth\pagewidth

        \setbox0\hbox{
            \begin{tabular}{c}
                #1
            \end{tabular}
        }
        \pageheight=\dimexpr\ht0+\dp0\relax
        \pagewidth=\wd0
        \shipout\box0

        \setlength\pageheight\prevpageheight
        \setlength\pagewidth\prevpagewidth

        \restoregeometry
    }
}

\DeclareOption{withNoIndent}{
    \newcommand{\withNoIndent}[1]{
        {
        \setlength{\parindent}{0pt}
        #1
        }
    }
}

\DeclareOption{runUnitTests}{
    \newcommand{\runUnitTests}{%
        \newcommand*{\getlength}[2]{% Result in `pt`
            \pgfmathsetmacro##1{round(##2)}%
        }
    
        % Precision resulting from `round` in "getlength".
        \newcommand{\precision}{%
            \pm 0.5 pt
        }
    
        \newcommand{\testTotalHeightMatches}[3]{%
            \settototalheight{\effectiveHeight}{##2}
            \getlength{\effective}{\effectiveHeight}
            \assert{Total height of ##3 matches ##1\precision}{##1}{\effective}
        }
    
        \newcommand{\testWidthMatches}[3]{%
            \setlength\effectiveWidth{\widthof##2}
            \getlength{\effective}{\the\effectiveWidth}
            \assert{Width of ##3 matches ##1\precision}{##1}{\effective}
        }
    
        \locdimen\effective
        \locdimen\effectiveHeight
        \locdimen\effectiveWidth
    
        Unit test results:

        \testWidthMatches{307.0}{\PolitechnikaWarszawska}{PolitechnikaWarszawska}
        
        \testTotalHeightMatches{51.0}{\eitilogo@UczelniaIWydzialColumn{Politechnika Warszawska}{Wydział Elektroniki i~Technik~Informacyjnych}}{UczelniaIWydzialColumn}
        
        \testTotalHeightMatches{51.0}{\UczelniaIWydzial}{UczelniaIWydzial}
        
        \testTotalHeightMatches{51.0}{\FacultyHeader{Wydział Elektroniki i~Technik~Informacyjnych}}{FacultyHeader with faculty set}
        
        \testTotalHeightMatches{50.0}{
            \FacultyHeader[Warsaw University of Technology]
                {Faculty of Electronics and~Information~Technology}
            }{FacultyHeader with custom faculty and university set}
    }
}

\DeclareOption{showExamples}{
    \newcommand{\showExamples}{%
        \fbox{\UczelniaIWydzial}
    }
}

\ProcessOptions\relax

% EXPERIMENTAL

% Usage: \exportmultiple
%
% \newcommand{\exportmultiple}{%
%     \newcount\tmpnum
%     \def\test ##1{\tmpnum=0 \def\param{##1}\testA{}\end}
%     \def\testA ##1{\ifx\end##1\relax\else
%        \advance\tmpnum by 1
%        \param\the\tmpnum:\ifx^##1^\param \else##1\fi \space
%        \expandafter\testA \fi
%     }
    
%     \test{}{a}{b}
% }